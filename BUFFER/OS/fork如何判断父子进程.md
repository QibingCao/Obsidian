---

类型: 笔记
创建日期: 2024-05-06
修改日期: 2024-05-06
---
![[Pasted image 20240506200034.png]]
父进程的eax中保存着INT中断执行后的结果，
在c语言程序中表现为res为对应的值结果，但是子进程eax中值为0。

### GPT
在 Unix 和类似 Unix 的操作系统（如 Linux）中，`fork()` 函数用于创建新进程。在底层视角下，这个过程涉及以下步骤：

1. **系统调用**：  
    `fork()` 是一个系统调用，由应用程序请求，内核负责实际执行。应用程序调用时，内核会创建一个与当前进程几乎完全相同的副本。
    
2. **进程表与数据结构**：  
    操作系统维护着一个进程表，其中包含每个进程的信息。执行 `fork()` 后，内核会为新进程分配一个新的进程表项，其中包括新的进程 ID (PID)，以及与父进程类似的资源描述符，比如文件描述符、内存映射和执行状态。
    
3. **内存管理**：  
    新进程拥有父进程的整个虚拟地址空间副本。但为提高效率，Unix 系统通常使用写时复制（Copy-On-Write，COW）技术：父子进程共享内存页，直到其中一个尝试修改时，内核才为修改的进程分配新的内存页。
    
4. **返回值**：  
    `fork()` 调用在父子进程中都会返回，区别在于返回值不同：
    
    - **父进程**：`fork()` 在父进程中返回新创建的子进程的 PID。
    - **子进程**：`fork()` 在子进程中返回 0。
5. **区分父子进程**：  
    因为 `fork()` 返回的值不同，父子进程能够通过判断返回值来决定它们接下来的行为：
    
    - 父进程使用返回的子进程 PID 来跟踪并管理子进程。
    - 子进程返回值为 0，表示它是新创建的子进程，并执行相应的初始化操作。
6. **错误处理**：  
    如果 `fork()` 失败，会返回 -1，并设置全局变量 `errno`。这种情况通常是因为系统资源不足，或超出了用户可以创建的最大进程数限制。
    

通过 `fork()` 的返回值和内存管理机制，父子进程可以有效地区分，并执行各自独立的任务。